parameters:
- name: Clouds
  type: string
  default: 'AzureCloud'
- name: Platforms
  type: object
  default: []
- name: AdditionalParameters
  type: object
  default: []

stages:
  - stage: AzureCloud
    condition: or(contains('${{ parameters.Clouds }}', 'AzureCloud'), contains('${{ parameters.Clouds }}', '*'))
    jobs:
    - template: ../../jobs/platforms.yml
      parameters:
        Platforms: ${{ parameters.Platforms }}
        CloudConfig:
          DisplayName: "AzureCloud"
          SubscriptionConfiguration: $(sub-config-azure-cloud-test-resources)
          ArmTemplateParameters: >-
            @{ keyVaultDomainSuffix = '.vault.azure.net';
               storageEndpointSuffix = 'core.windows.net';
               endpointSuffix = '.cognitiveservices.azure.com';
               azureAuthorityHost = 'https://login.microsoftonline.com/';
               keyVaultEndpointSuffix = '.vault.azure.net' }
          EnvVars:
            SERVICE_MANAGEMENT_URL: https://management.core.windows.net/
            STORAGE_ENDPOINT_SUFFIX: core.windows.net
            RESOURCE_MANAGER_URL: https://management.azure.com/
            SEARCH_ENDPOINT_SUFFIX: search.windows.net
            COSMOS_TABLES_ENDPOINT_SUFFIX: cosmos.azure.com
        AdditionalParameters: ${{ parameters.AdditionalParameters }}
  - stage: AzureCloud_Preview
    condition: or(contains('${{ parameters.Clouds }}', 'AzureCloud_Preview'), contains('${{ parameters.Clouds }}', '*'))
    jobs:
    - template: ../../jobs/platforms.yml
      parameters:
        Platforms: ${{ parameters.Platforms }}
        CloudConfig:
          DisplayName: "AzureCloud - Preview"
          SubscriptionConfiguration: $(sub-config-azure-cloud-test-resources-preview)
          ArmTemplateParameters: >-
            @{ keyVaultDomainSuffix = '.vault.azure.net';
               storageEndpointSuffix = 'core.windows.net';
               endpointSuffix = '.cognitiveservices.azure.com';
               azureAuthorityHost = 'https://login.microsoftonline.com/';
               keyVaultEndpointSuffix = '.vault.azure.net' }
          EnvVars:
            SERVICE_MANAGEMENT_URL: https://management.core.windows.net/
            STORAGE_ENDPOINT_SUFFIX: core.windows.net
            RESOURCE_MANAGER_URL: https://management.azure.com/
            SEARCH_ENDPOINT_SUFFIX: search.windows.net
            COSMOS_TABLES_ENDPOINT_SUFFIX: cosmos.azure.com
        AdditionalParameters: ${{ parameters.AdditionalParameters }}
  - stage: AzureUsGovCloud
    condition: or(contains('${{ parameters.Clouds }}', 'AzureUsGovCloud'), contains('${{ parameters.Clouds }}', '*'))
    jobs:
    - template: ../../jobs/platforms.yml
      parameters:
        Platforms: ${{ parameters.Platforms }}
        CloudConfig:
          DisplayName: "AzureUsGovCloud"
          SubscriptionConfiguration: $(sub-config-gov-test-resources)
          ArmTemplateParameters: >-
            @{ keyVaultDomainSuffix = '.vault.usgovcloudapi.net';
               storageEndpointSuffix = 'core.usgovcloudapi.net';
               endpointSuffix = '.cognitiveservices.azure.us';
               azureAuthorityHost = 'https://login.microsoftonline.us/';
               keyVaultEndpointSuffix = '.vault.usgovcloudapi.net';
               enableStorageVersioning = $false }
          EnvVars:
            AZURE_AUTHORITY_HOST: https://login.microsoftonline.us
            RESOURCE_MANAGER_URL: https://management.usgovcloudapi.net/
            STORAGE_ENDPOINT_SUFFIX: core.usgovcloudapi.net
            SERVICE_MANAGEMENT_URL: https://management.core.usgovcloudapi.net/
          SEARCH_ENDPOINT_SUFFIX: search.azure.us
          COSMOS_TABLES_ENDPOINT_SUFFIX: cosmos.azure.us
        AdditionalParameters: ${{ parameters.AdditionalParameters }}
  - stage: AzureChinaCloud
    condition: or(contains('${{ parameters.Clouds }}', 'AzureChinaCloud'), contains('${{ parameters.Clouds }}', '*'))
    jobs:
    - template: ../../jobs/platforms.yml
      parameters:
        Platforms: ${{ parameters.Platforms }}
        CloudConfig:
          DisplayName: "AzureChinaCloud"
          SubscriptionConfiguration: $(sub-config-cn-test-resources)
          ArmTemplateParameters: >-
            @{ keyVaultDomainSuffix = '.vault.azure.cn';
               storageEndpointSuffix = 'core.chinacloudapi.cn';
               azureAuthorityHost = 'https://login.chinacloudapi.cn/';
               keyVaultEndpointSuffix = '.vault.azure.cn';
               keyVaultSku = 'standard';
               enableStorageVersioning = $false;
               endpointSuffix = '.cognitiveservices.azure.cn';
               textAnalyticsSku = 'S' }
          EnvVars:
            AZURE_AUTHORITY_HOST: https://login.chinacloudapi.cn
            SERVICE_MANAGEMENT_URL: https://management.core.chinacloudapi.cn/
          RESOURCE_MANAGER_URL: https://management.chinacloudapi.cn
          STORAGE_ENDPOINT_SUFFIX: core.chinacloudapi.cn
          SEARCH_ENDPOINT_SUFFIX: search.azure.cn
          COSMOS_TABLES_ENDPOINT_SUFFIX: cosmos.azure.cn
        AdditionalParameters: ${{ parameters.AdditionalParameters }}
